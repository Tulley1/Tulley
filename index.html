<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stock Market News Monitor - Live</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #0f172a 100%);
            min-height: 100vh;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            padding: 24px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        .api-setup {
            background: linear-gradient(135deg, #7c3aed 0%, #a855f7 100%);
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 32px;
            color: white;
        }

        .api-setup h2 {
            font-size: 1.5em;
            margin-bottom: 16px;
        }

        .api-setup p {
            margin-bottom: 16px;
            line-height: 1.6;
        }

        .api-setup input {
            width: 100%;
            padding: 12px;
            border-radius: 8px;
            border: none;
            margin-bottom: 12px;
            font-size: 1em;
        }

        .api-setup button {
            background: white;
            color: #7c3aed;
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .api-setup button:hover {
            transform: scale(1.05);
        }

        .api-setup a {
            color: #fbbf24;
            text-decoration: underline;
        }

        .api-info {
            background: rgba(255, 255, 255, 0.1);
            padding: 12px;
            border-radius: 8px;
            margin-top: 16px;
            font-size: 0.9em;
        }

        .status-banner {
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 16px;
            display: none;
        }

        .status-success {
            background: #10b981;
            color: white;
        }

        .status-error {
            background: #ef4444;
            color: white;
        }
        
        .header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 32px;
            flex-wrap: wrap;
            gap: 16px;
        }
        
        .header-left {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .icon-box {
            padding: 12px;
            background: #3b82f6;
            border-radius: 8px;
        }
        
        .icon-box svg {
            width: 32px;
            height: 32px;
            color: white;
        }
        
        h1 {
            font-size: 2em;
            font-weight: bold;
            color: white;
        }
        
        .subtitle {
            color: #94a3b8;
            font-size: 0.95em;
        }
        
        .refresh-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 16px;
            background: #3b82f6;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.95em;
            transition: background 0.2s;
        }
        
        .refresh-btn:hover {
            background: #2563eb;
        }
        
        .refresh-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .refresh-btn svg {
            width: 16px;
            height: 16px;
        }

        .insights-section {
            background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 100%);
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 32px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
        }

        .insights-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 16px;
        }

        .insights-header svg {
            width: 24px;
            height: 24px;
            color: #fbbf24;
        }

        .insights-header h2 {
            font-size: 1.5em;
            color: white;
        }

        .insights-content {
            color: white;
            line-height: 1.8;
        }

        .suggestion-list {
            list-style: none;
            padding: 0;
            margin-top: 16px;
        }

        .suggestion-list li {
            padding: 12px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            margin-bottom: 8px;
            padding-left: 36px;
            position: relative;
        }

        .suggestion-list li::before {
            content: "üí°";
            position: absolute;
            left: 12px;
            top: 12px;
        }
        
        .controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 12px;
            margin-bottom: 32px;
        }
        
        .search-input {
            padding: 10px 16px;
            background: #1e293b;
            color: white;
            border: 1px solid #334155;
            border-radius: 8px;
            font-size: 0.95em;
            grid-column: 1 / -1;
        }
        
        .search-input:focus {
            outline: none;
            border-color: #3b82f6;
        }
        
        .category-select {
            padding: 10px 16px;
            background: #1e293b;
            color: white;
            border: 1px solid #334155;
            border-radius: 8px;
            font-size: 0.95em;
            cursor: pointer;
        }
        
        .category-select:focus {
            outline: none;
            border-color: #3b82f6;
        }
        
        .news-item {
            background: #1e293b;
            border: 1px solid #334155;
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 16px;
            transition: all 0.2s;
            cursor: pointer;
        }
        
        .news-item:hover {
            border-color: #3b82f6;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.3);
        }

        .news-item.expanded {
            border-color: #3b82f6;
            box-shadow: 0 8px 16px rgba(59, 130, 246, 0.4);
        }
        
        .news-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 12px;
            flex-wrap: wrap;
        }
        
        .category-badge {
            padding: 6px 12px;
            border-radius: 16px;
            font-size: 0.75em;
            font-weight: 600;
            background: #3b82f6;
            color: white;
        }

        .premium-badge {
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.7em;
            font-weight: 700;
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            color: white;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .time {
            color: #64748b;
            font-size: 0.85em;
        }
        
        .company-name {
            font-size: 1.25em;
            font-weight: bold;
            color: white;
            margin-bottom: 8px;
        }
        
        .ticker {
            display: inline-block;
            padding: 4px 8px;
            background: #334155;
            color: #60a5fa;
            font-size: 0.75em;
            font-family: monospace;
            border-radius: 4px;
            margin-left: 8px;
        }
        
        .headline {
            font-size: 1.1em;
            color: #e2e8f0;
            margin-bottom: 8px;
        }
        
        .summary {
            color: #94a3b8;
            font-size: 0.9em;
            line-height: 1.6;
        }

        .analysis-section {
            margin-top: 24px;
            padding-top: 24px;
            border-top: 2px solid #334155;
            display: none;
        }

        .analysis-section.visible {
            display: block;
        }

        .analysis-header {
            display: flex;
            align-items: center;
            gap: 8px;
            color: #fbbf24;
            font-size: 1.1em;
            font-weight: bold;
            margin-bottom: 16px;
        }

        .analysis-header svg {
            width: 20px;
            height: 20px;
        }

        .analysis-card {
            background: #0f172a;
            border-left: 4px solid #3b82f6;
            padding: 16px;
            margin-bottom: 16px;
            border-radius: 8px;
        }

        .analysis-card h4 {
            color: #60a5fa;
            font-size: 1em;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .analysis-card h4 svg {
            width: 18px;
            height: 18px;
        }

        .analysis-card p {
            color: #cbd5e1;
            line-height: 1.7;
            margin-bottom: 8px;
        }

        .analysis-card ul {
            list-style: none;
            padding: 0;
            margin-top: 12px;
        }

        .analysis-card li {
            color: #94a3b8;
            padding: 6px 0;
            padding-left: 20px;
            position: relative;
        }

        .analysis-card li::before {
            content: "‚ñ∏";
            position: absolute;
            left: 0;
            color: #3b82f6;
        }

        .disclaimer {
            background: rgba(251, 191, 36, 0.1);
            border: 1px solid rgba(251, 191, 36, 0.3);
            padding: 12px;
            border-radius: 8px;
            margin-top: 16px;
        }

        .disclaimer p {
            color: #fbbf24;
            font-size: 0.85em;
            line-height: 1.6;
        }

        .click-hint {
            color: #60a5fa;
            font-size: 0.85em;
            margin-top: 12px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .click-hint svg {
            width: 16px;
            height: 16px;
        }
        
        .news-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 16px;
            padding-top: 16px;
            border-top: 1px solid #334155;
            flex-wrap: wrap;
            gap: 12px;
        }
        
        .source {
            display: flex;
            align-items: center;
            gap: 8px;
            color: #64748b;
            font-size: 0.85em;
        }
        
        .read-more {
            color: #60a5fa;
            text-decoration: none;
            font-size: 0.85em;
            font-weight: 500;
            transition: color 0.2s;
        }
        
        .read-more:hover {
            color: #93c5fd;
        }
        
        .loading {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 80px 0;
        }
        
        .spinner {
            width: 48px;
            height: 48px;
            color: #3b82f6;
            animation: spin 1s linear infinite;
            margin-bottom: 16px;
        }
        
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        .loading-text {
            color: #94a3b8;
            font-size: 1.1em;
        }
        
        .no-results {
            text-align: center;
            padding: 80px 20px;
            color: #94a3b8;
        }
        
        @media (max-width: 768px) {
            h1 { font-size: 1.5em; }
            .controls { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- API Setup Section -->
        <div class="api-setup" id="apiSetup">
            <h2>üîë Setup Your Free API Key</h2>
            <p>Get access to news from 5000+ sources including Bloomberg, Reuters, WSJ, CNBC, Financial Times, and more!</p>
            <p><strong>Recommended:</strong> <a href="https://finnhub.io/register" target="_blank">Finnhub (Click to register - Free!)</a></p>
            <p><strong>Alternative:</strong> <a href="https://www.alphavantage.co/support/#api-key" target="_blank">Alpha Vantage</a></p>
            <input type="text" id="apiKeyInput" placeholder="Paste your API key here...">
            <button onclick="saveApiKey()">Save API Key & Load Real News</button>
            <div class="api-info">
                üí° <strong>Tip:</strong> Finnhub aggregates news from thousands of premium sources. Registration is instant and completely free with 60 API calls/minute!
            </div>
            <div id="statusBanner" class="status-banner"></div>
        </div>

        <div class="header">
            <div class="header-left">
                <div class="icon-box">
                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>
                </div>
                <div>
                    <h1>Stock Market News Monitor</h1>
                    <p class="subtitle">Live news from 5000+ sources with AI-powered analysis</p>
                </div>
            </div>
            <button class="refresh-btn" onclick="fetchRealNews()" id="refreshBtn" style="display:none;">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                </svg>
                Refresh News
            </button>
        </div>

        <!-- AI Insights Section -->
        <div class="insights-section" id="insightsSection" style="display: none;">
            <div class="insights-header">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"></path>
                </svg>
                <h2>AI-Powered Market Insights</h2>
            </div>
            <div class="insights-content" id="insightsContent">
                <p>Loading insights...</p>
            </div>
        </div>

        <div class="controls" id="controls" style="display: none;">
            <input 
                type="text" 
                class="search-input" 
                id="searchInput" 
                placeholder="Search by company, ticker, or headline..."
                onkeyup="filterNews()"
            >
            <select class="category-select" id="sectorFilter" onchange="fetchRealNews()">
                <option value="general">üì∞ Major Market News</option>
                <option value="forex">üí± Forex & Currencies</option>
                <option value="crypto">‚Çø Cryptocurrency</option>
                <option value="merger">ü§ù Mergers & Acquisitions</option>
            </select>
            <select class="category-select" id="sourceFilter" onchange="filterNews()">
                <option value="all">All Sources</option>
                <option value="bloomberg">Bloomberg</option>
                <option value="reuters">Reuters</option>
                <option value="wsj">Wall Street Journal</option>
                <option value="cnbc">CNBC</option>
                <option value="ft">Financial Times</option>
                <option value="marketwatch">MarketWatch</option>
                <option value="barrons">Barron's</option>
                <option value="seekingalpha">Seeking Alpha</option>
            </select>
        </div>

        <div id="newsFeed"></div>
    </div>

    <script>
        let apiKey = '';
        let allNews = [];

        function saveApiKey() {
            const input = document.getElementById('apiKeyInput');
            apiKey = input.value.trim();
            
            if (!apiKey) {
                showStatus('Please enter an API key', 'error');
                return;
            }

            localStorage.setItem('stockNewsApiKey', apiKey);
            showStatus('API key saved! Loading news from thousands of sources...', 'success');
            
            document.getElementById('apiSetup').style.display = 'none';
            document.getElementById('controls').style.display = 'grid';
            document.getElementById('refreshBtn').style.display = 'flex';
            
            fetchRealNews();
        }

        async function fetchRealNews() {
            const feed = document.getElementById('newsFeed');
            const btn = document.getElementById('refreshBtn');
            const sector = document.getElementById('sectorFilter')?.value || 'general';
            
            btn.disabled = true;
            feed.innerHTML = '<div class="loading"><svg class="spinner" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path></svg><div class="loading-text">Fetching live market news from thousands of sources...</div></div>';

            try {
                // Correct Finnhub endpoint for market news
                const response = await fetch(`https://finnhub.io/api/v1/news?category=${sector}&token=${apiKey}`);
                
                if (!response.ok) {
                    if (response.status === 401) {
                        throw new Error('Invalid API key. Please check your key and try again.');
                    }
                    throw new Error(`API request failed with status ${response.status}`);
                }

                const data = await response.json();
                
                if (data && Array.isArray(data) && data.length > 0) {
                    // Premium sources list
                    const premiumSources = [
                        'Bloomberg', 'Reuters', 'Wall Street Journal', 'WSJ', 'CNBC', 
                        'Financial Times', 'FT', 'MarketWatch', 'Barron\'s', 
                        'Seeking Alpha', 'Yahoo Finance', 'Business Insider',
                        'Forbes', 'The Economist', 'Investor\'s Business Daily',
                        'TheStreet', 'Benzinga', 'Zacks', 'GuruFocus'
                    ];
                    
                    allNews = data.slice(0, 50).map((item, index) => {
                        const isPremium = premiumSources.some(p => 
                            (item.source || '').toLowerCase().includes(p.toLowerCase())
                        );
                        
                        return {
                            id: index,
                            headline: item.headline || 'No headline',
                            summary: item.summary || 'No summary available',
                            source: item.source || 'Unknown',
                            time: formatTime(item.datetime),
                            url: item.url || '#',
                            category: sector,
                            related: item.related || '',
                            isPremium: isPremium
                        };
                    });

                    // Sort by premium sources first, then by time
                    allNews.sort((a, b) => {
                        if (a.isPremium && !b.isPremium) return -1;
                        if (!a.isPremium && b.isPremium) return 1;
                        return 0;
                    });

                    analyzeAndShowInsights();
                    renderNews(allNews);
                    
                    const premiumCount = allNews.filter(n => n.isPremium).length;
                    console.log(`‚úÖ Loaded ${allNews.length} articles (${premiumCount} from premium sources)`);
                } else {
                    throw new Error('No news data available for this category');
                }

            } catch (error) {
                console.error('Error:', error);
                feed.innerHTML = `
                    <div class="no-results">
                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" style="width: 48px; height: 48px; margin: 0 auto 16px; opacity: 0.5;">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                        <p><strong>Error loading news</strong></p>
                        <p style="margin-top: 12px;">${error.message}</p>
                        <p style="margin-top: 8px; font-size: 0.9em;">Make sure you're using a valid Finnhub API key from <a href="https://finnhub.io/register" style="color: #60a5fa;">finnhub.io</a></p>
                        <button onclick="location.reload()" style="margin-top: 20px; padding: 10px 20px; background: #3b82f6; color: white; border: none; border-radius: 8px; cursor: pointer;">Reset & Try Again</button>
                    </div>
                `;
            }

            btn.disabled = false;
        }

        function showStatus(message, type) {
            const banner = document.getElementById('statusBanner');
            banner.textContent = message;
            banner.className = `status-banner status-${type}`;
            banner.style.display = 'block';
            
            setTimeout(() => {
                banner.style.display = 'none';
            }, 3000);
        }

        function formatTime(timestamp) {
            const date = new Date(timestamp * 1000);
            const now = new Date();
            const diffMs = now - date;
            const diffHours = Math.floor(diffMs / (1000 * 60 * 60));
            const diffDays = Math.floor(diffHours / 24);

            if (diffHours < 1) return 'Less than 1 hour ago';
            if (diffHours < 24) return `${diffHours} hour${diffHours > 1 ? 's' : ''} ago`;
            if (diffDays === 1) return '1 day ago';
            if (diffDays < 7) return `${diffDays} days ago`;
            return date.toLocaleDateString();
        }

        function analyzeAndShowInsights() {
            const insightsSection = document.getElementById('insightsSection');
            const insightsContent = document.getElementById('insightsContent');
            
            insightsSection.style.display = 'block';

            const totalNews = allNews.length;
            const sources = [...new Set(allNews.map(n => n.source))].length;
            const recentNews = allNews.filter(n => n.time.includes('hour')).length;
            const premiumCount = allNews.filter(n => n.isPremium).length;

            const suggestions = [
                `üìä Analyzing ${totalNews} market news articles from ${sources} different sources`,
                `‚≠ê ${premiumCount} articles from premium sources (Bloomberg, Reuters, WSJ, etc.)`,
                `‚è∞ ${recentNews} breaking stories in the last few hours`,
                `üí° High news volume indicates active market conditions - stay informed`,
                `üìà Multiple sources covering similar topics suggests significant market events`
            ];

            insightsContent.innerHTML = `
                <p><strong>Real-Time Market Analysis:</strong></p>
                <ul class="suggestion-list">
                    ${suggestions.map(s => `<li>${s}</li>`).join('')}
                </ul>
            `;
        }

        function generateAnalysis(headline, summary, category) {
            const isPositive = /beat|exceed|surge|jump|gain|rise|growth|profit|success|increase|up|high|strong|positive/i.test(headline + summary);
            const isNegative = /miss|drop|fall|decline|loss|cut|reduce|lower|weak|concern|down|plunge|crash|negative/i.test(headline + summary);
            const isMerger = /merger|acquisition|acquire|deal|purchase|buy|takeover/i.test(headline + summary);
            const isEarnings = /earnings|revenue|profit|quarter|q[1-4]|fiscal|results/i.test(headline + summary);
            
            let companyImpact = '';
            let priceImpact = '';
            let considerations = [];

            if (isEarnings) {
                if (isPositive) {
                    companyImpact = 'This earnings beat indicates the company exceeded analyst expectations, demonstrating stronger-than-anticipated operational performance. Historical data shows companies that beat earnings estimates often report: improved operational efficiency, stronger demand for products/services, or better cost management.';
                    priceImpact = 'Positive earnings developments historically correlate with upward price momentum. Statistical analysis shows:';
                    considerations = [
                        'Average price increase of 2-5% in the 5 days following positive earnings beats',
                        'Institutional buying often increases following positive news',
                        'Options market typically prices in 1-3% moves on earnings announcements',
                        'Watch for "buy the rumor, sell the news" patterns if expectations were already elevated'
                    ];
                } else if (isNegative) {
                    companyImpact = 'This earnings miss suggests the company underperformed relative to analyst expectations. Statistically, earnings misses can indicate: weaker demand, operational challenges, increased competition, or unfavorable market conditions.';
                    priceImpact = 'Negative earnings developments typically correlate with downward price pressure. Historical patterns indicate:';
                    considerations = [
                        'Average price decrease of 3-7% in the 5 days following earnings misses',
                        'Increased selling pressure from institutional investors managing risk',
                        'Potential analyst downgrades and revised price targets',
                        'Support levels may be tested; monitor key technical indicators'
                    ];
                }
            } else if (isMerger) {
                companyImpact = 'M&A activity typically signals strategic expansion or consolidation. Historical precedent shows acquisitions can: increase market share, provide access to new technologies/markets, create operational synergies, or eliminate competition. Integration risks and debt levels warrant analysis.';
                priceImpact = 'M&A announcements show varied price impacts depending on deal structure:';
                considerations = [
                    'Acquiring companies often see 1-3% price decline initially (acquisition premium concern)',
                    'Target companies typically see prices rise toward acquisition price',
                    'Long-term success depends on integration execution and synergy realization',
                    'Monitor deal terms, financing structure, and regulatory approval timeline'
                ];
            } else {
                companyImpact = 'This development represents a material business event. Impact assessment requires examining: the scale of the announcement, sector context, company financials, and competitive positioning. Historical patterns suggest such events often influence operational trajectory.';
                priceImpact = 'Market reaction depends on multiple factors. Consider:';
                considerations = [
                    'Broader market sentiment and sector performance',
                    'Details in company communications and guidance',
                    'Analyst interpretations and revised forecasts',
                    'Overall market volatility and macroeconomic conditions'
                ];
            }

            const objectiveConsiderations = [
                '<strong>Data Points to Monitor:</strong> Trading volume (indicates conviction), relative strength vs sector peers, options flow (institutional positioning), and analyst rating changes',
                '<strong>Historical Context:</strong> Compare current metrics to company\'s 5-year averages, sector benchmarks, and similar events from peer companies',
                '<strong>Risk Management:</strong> Consider position sizing, stop-loss levels based on technical support, diversification, and alignment with your time horizon',
                '<strong>Due Diligence:</strong> Review SEC filings, earnings transcripts, and independent research reports before making investment decisions'
            ];

            return {
                companyImpact,
                priceImpact,
                considerations,
                objectiveConsiderations
            };
        }

        function toggleAnalysis(newsId) {
            const newsItem = document.getElementById(`news-${newsId}`);
            const analysisSection = newsItem.querySelector('.analysis-section');
            
            if (analysisSection.classList.contains('visible')) {
                analysisSection.classList.remove('visible');
                newsItem.classList.remove('expanded');
            } else {
                document.querySelectorAll('.analysis-section.visible').forEach(el => {
                    el.classList.remove('visible');
                    el.parentElement.classList.remove('expanded');
                });
                
                analysisSection.classList.add('visible');
                newsItem.classList.add('expanded');
                
                setTimeout(() => {
                    analysisSection.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
                }, 100);
            }
        }

        function renderNews(newsArray) {
            const feed = document.getElementById('newsFeed');
            
            if (newsArray.length === 0) {
                feed.innerHTML = '<div class="no-results"><p>No news items found matching your criteria</p></div>';
                return;
            }

            feed.innerHTML = newsArray.map(item => {
                const analysis = generateAnalysis(item.headline, item.summary, item.category);
                
                return `
                <div class="news-item" id="news-${item.id}" onclick="toggleAnalysis(${item.id})">
                    <div class="news-header">
                        <span class="category-badge">${item.category.toUpperCase()}</span>
                        ${item.isPremium ? '<span class="premium-badge">Premium Source</span>' : ''}
                        <span class="time">${item.time}</span>
                    </div>
                    <div>
                        <div class="headline">${item.headline}</div>
                        ${item.related ? `<div class="company-name">Related: <span class="ticker">${item.related}</span></div>` : ''}
                        <div class="summary">${item.summary}</div>
                        <div class="click-hint">
                            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                            Click for detailed analysis
                        </div>
                    </div>

                    <div class="analysis-section">
                        <div class="analysis-header">
                            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                            </svg>
                            Data-Driven Analysis
                        </div>

                        <div class="analysis-card">
                            <h4>
                                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"></path>
                                </svg>
                                1. Company Impact
                            </h4>
                            <p>${analysis.companyImpact}</p>
                        </div>

                        <div class="analysis-card">
                            <h4>
                                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"></path>
                                </svg>
                                2. Historical Price Impact Patterns
                            </h4>
                            <p>${analysis.priceImpact}</p>
                            <ul>
                                ${analysis.considerations.map(c => `<li>${c}</li>`).join('')}
                            </ul>
                        </div>

                        <div class="analysis-card">
                            <h4>
                                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"></path>
                                </svg>
                                3. Objective Considerations & Due Diligence
                            </h4>
                            ${analysis.objectiveConsiderations.map(c => `<p>${c}</p>`).join('')}
                        </div>

                        <div class="disclaimer">
                            <p><strong>‚ö†Ô∏è Educational Purpose Only:</strong> This analysis is based on historical data patterns and statistical correlations. It is NOT investment advice. Markets are unpredictable and past performance does not guarantee future results. Always conduct your own research, consult financial professionals, and make decisions based on your individual circumstances.</p>
                        </div>
                    </div>

                    <div class="news-footer">
                        <div class="source">
                            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" style="width: 16px; height: 16px;">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 20H5a2 2 0 01-2-2V6a2 2 0 012-2h10a2 2 0 012 2v1m2 13a2 2 0 01-2-2V7m2 13a2 2 0 002-2V9a2 2 0 00-2-2h-2m-4-3H9M7 16h6M7 8h6v4H7V8z"></path>
                            </svg>
                            ${item.source}
                        </div>
                        <a href="${item.url}" target="_blank" class="read-more" onclick="event.stopPropagation()">Read Full Article ‚Üí</a>
                    </div>
                </div>
            `}).join('');
        }

        function filterNews() {
            const search = document.getElementById('searchInput').value.toLowerCase();
            const sourceFilter = document.getElementById('sourceFilter')?.value || 'all';

            const filtered = allNews.filter(item => {
                const matchSource = sourceFilter === 'all' || 
                    item.source.toLowerCase().includes(sourceFilter.toLowerCase());
                const matchSearch = !search || 
                    item.headline.toLowerCase().includes(search) ||
                    item.summary.toLowerCase().includes(search) ||
                    item.source.toLowerCase().includes(search) ||
                    (item.related && item.related.toLowerCase().includes(search));
                return matchSource && matchSearch;
            });

            renderNews(filtered);
        }

        window.onload = function() {
            const savedKey = localStorage.getItem('stockNewsApiKey');
            if (savedKey) {
                apiKey = savedKey;
                document.getElementById('apiKeyInput').value = savedKey;
                document.getElementById('apiSetup').style.display = 'none';
                document.getElementById('controls').style.display = 'grid';
                document.getElementById('refreshBtn').style.display = 'flex';
                fetchRealNews();
            }
        };
    </script>
</body>
</html>
